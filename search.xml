<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>从头学C</title>
      <link href="/2022/11/07/%E4%BB%8E0%E5%AD%A6C/"/>
      <url>/2022/11/07/%E4%BB%8E0%E5%AD%A6C/</url>
      
        <content type="html"><![CDATA[<p>前言：主要是一些发散问题</p><h1 id="字符串、字符、数据类型"><a href="#字符串、字符、数据类型" class="headerlink" title="字符串、字符、数据类型"></a>字符串、字符、数据类型</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> ch;</span><br></pre></td></tr></table></figure><p>ch是有符号还是无符号的？</p><p>答：有无符号由编译器决定。所以写的时候尽量就</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">signed</span> <span class="type">char</span> ch;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ch;</span><br></pre></td></tr></table></figure><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">L&quot;hello中国&quot;</span> </span><br></pre></td></tr></table></figure><p>宽字节字符串 –每个字符宽度一样，unicode编码，windows平台占2字节（unicode16），linux、macos、java平台占4字节 (unicode32)，在驱动中是宽字节字符串</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;hello中国&quot;</span> </span><br></pre></td></tr></table></figure><p>多字节字符串，字节宽度可能不一样</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_T(<span class="string">&quot;hello&quot;</span>)</span><br></pre></td></tr></table></figure><p>宏，由平台决定</p><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">L&#x27;a&#x27;</span>     <span class="string">&#x27;a&#x27;</span>        前面这个a是unicode编码字符win2 linux4。</span><br><span class="line"></span><br><span class="line"><span class="string">L&#x27;0&#x27;</span>, 字符</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;0&#x27;</span>,--》<span class="number">48</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;\0&#x27;</span>--》<span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;0&quot;</span>字符串,--〉&#123;<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;\0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="literal">NULL</span> --&gt;指针 --&gt; (<span class="type">void</span>*) <span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;100&quot;</span>,--&gt;字符串，<span class="number">4</span>个</span><br><span class="line"></span><br><span class="line"><span class="number">100</span>,--&gt;整数</span><br><span class="line"></span><br><span class="line"><span class="number">100</span>I64 --&gt;<span class="number">64</span>位整数，占<span class="number">8</span>个字节</span><br></pre></td></tr></table></figure><h1 id="数据打印格式"><a href="#数据打印格式" class="headerlink" title="数据打印格式"></a>数据打印格式</h1><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%c </span><br><span class="line">%wc %C 宽字节</span><br><span class="line"></span><br><span class="line">%d %hd %ld </span><br><span class="line"></span><br><span class="line">%hd-&gt;<span class="type">short</span> <span class="number">2</span>字节整数</span><br><span class="line"></span><br><span class="line">%ld -&gt;<span class="type">long</span> <span class="number">4</span>字节</span><br><span class="line"></span><br><span class="line">%I63d(_int64) <span class="number">64</span>位整数（时间、文件）</span><br><span class="line"></span><br><span class="line">%lld(<span class="type">long</span> <span class="type">long</span> 或_int64)</span><br><span class="line">  </span><br><span class="line">%s %ws %S 宽字节</span><br><span class="line">%u无符号 %x整数当作<span class="number">16</span>进制打印 %<span class="number">02</span>x把一个字节当成<span class="number">16</span>进制，只有一位用<span class="number">0</span>填充</span><br><span class="line">%o <span class="number">8</span>进制 %p 打印地址或指针 </span><br><span class="line">%f %lf %<span class="number">.2</span>f打印小数点后两位</span><br><span class="line">%Z  --&gt; ANSI_STRING 缓存</span><br><span class="line">%wz --&gt; UNICODE_STRING 缓存 </span><br><span class="line">%n --&gt; 会引起漏洞--格式化漏洞 </span><br><span class="line">%% --&gt; 打印一个%</span><br></pre></td></tr></table></figure><h2 id="printf引发的格式化串漏洞"><a href="#printf引发的格式化串漏洞" class="headerlink" title="printf引发的格式化串漏洞"></a>printf引发的格式化串漏洞</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;hello world&quot;</span>); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;s&quot;</span>,<span class="string">&quot;hello world&quot;</span>);</span><br></pre></td></tr></table></figure><p>这两个好坏是一样的，无所谓</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Print1(<span class="type">char</span> *s)&#123;</span><br><span class="line"></span><br><span class="line">​<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,s);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Print2(<span class="type">char</span> *s)&#123;</span><br><span class="line"></span><br><span class="line">​<span class="built_in">printf</span>(s);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1好，2有漏洞：</p><p>Print1(“%s%d%c%p”) ;–&gt;只当作普通字符串打印</p><p>但是如果是Print2(“%s%d%c%p”) ;传入后，输出就是</p><p>printf(“%s%d%c%p”); 会把栈上四个这样类型的数据打印出来，这就会暴露出来栈上的数据</p><p>%n更要命</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf(&quot;helloworld%n&quot;,&amp;i);</span><br></pre></td></tr></table></figure><p>%n作用是执行到%n之前，已经打印的字符的个数写到对应内存的位置去,也就意味着%n可以修改内存</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(bPassed==<span class="number">5</span>)</span><br><span class="line">&#123;start();&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;failed();&#125;</span><br></pre></td></tr></table></figure><p>只要输入个12345%n 就给过了</p><h2 id="如何在main函数前执行一段代码"><a href="#如何在main函数前执行一段代码" class="headerlink" title="如何在main函数前执行一段代码"></a>如何在main函数前执行一段代码</h2><p>main不是最早执行的函数。</p><p>在CONSOLE，main函数是用户定义的入口，但不是整个exe的入口</p><p>最早是连接器将mainCRTStartup连接到exe。</p><p>具体如图</p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/image-20221107210130443.png" alt="image-20221107210130443" style="zoom: 50%;" /><p>gcc:</p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/5%E3%80%81%E5%8F%91%E6%95%A3%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8main%E5%87%BD%E6%95%B0%E5%89%8D%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AE%B5%E4%BB%A3%E7%A0%81.pcwl_%E8%A7%86%E9%A2%91%E6%88%AA%E5%9B%BE_422.jpg" alt="5、发散：如何在main函数前执行一段代码.pcwl_视频截图_422" style="zoom: 25%;" /><p> VC:</p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/image-20221107210818157.png" alt="image-20221107210818157" style="zoom: 50%;" /><p>C++:</p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/image-20221107211536078.png" alt="image-20221107211536078" style="zoom: 50%;" />]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows用户凭证</title>
      <link href="/2022/11/07/Windows%E7%94%A8%E6%88%B7%E5%87%AD%E8%AF%81/"/>
      <url>/2022/11/07/Windows%E7%94%A8%E6%88%B7%E5%87%AD%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p>密码默认存储在</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%systemroot%\system32\config\</span><br></pre></td></tr></table></figure><h2 id="NTLM-Hash"><a href="#NTLM-Hash" class="headerlink" title="NTLM Hash"></a>NTLM Hash</h2><p>NTLM网络认证协议 是以NTLM HASH为凭证的一个认证协议</p><p>负责加密的进程是lsass.exe（2012前）</p><p>admin–&gt;hex &#x3D;61646d69e</p><p>61646d69e –&gt;unicode</p><p>unicode –&gt;md4 &#x3D;ntlm hash</p><p>python有个库</p><p>passlib.hash nthash</p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657620909303-de5b2ebd-5eb2-4230-9879-041cd906f4e2.png" alt="img"></p><p>windows的认证过程</p><p>winlogon.exe -&gt;接受输入 –&gt;lsass.exe –&gt;认证</p><h3 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a>LM Hash</h3><p>流程和ntlm差不多</p><p>后面的加密不一样</p><h3 id="ntlm-挑战响应"><a href="#ntlm-挑战响应" class="headerlink" title="ntlm: 挑战响应"></a>ntlm: 挑战响应</h3><p>1、协商 2、咨询 3、验证</p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657622390191-2b7c9033-0c8b-4eb8-a68f-c438232ed24b.png" alt="img"></p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657622404932-7e958be8-78cd-4c93-b161-d9c19e30d9f9.png" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 内网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wmic</title>
      <link href="/2022/11/07/wmic/"/>
      <url>/2022/11/07/wmic/</url>
      
        <content type="html"><![CDATA[<p>前提是开启</p><p><strong>windows management instrumentation</strong></p><p>两种模式，交互和非交互</p><h2 id="常用的信息收集命令"><a href="#常用的信息收集命令" class="headerlink" title="常用的信息收集命令"></a>常用的信息收集命令</h2><p>(&lt;别名&gt;[wmic 对象] |&lt;别名&gt; [&lt;路径where&gt;] | [&lt;别名&gt;] &lt;路径 where&gt;) [&lt;谓词子句&gt;]</p><p>enviroment:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assoc create delete get list set</span><br></pre></td></tr></table></figure><p>wmic environment list </p><p>–full brief instance status</p><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic environment list full</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic environment where &quot;name=TEMP&quot; get status,username</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount list brief</span><br></pre></td></tr></table></figure><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657016426789-9abbef13-67ce-42e6-99b9-155d7c81d605.png" alt="img"></p><h3 id="查看cpu"><a href="#查看cpu" class="headerlink" title="查看cpu"></a>查看cpu</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic cpu get name</span><br><span class="line">wmic cpu list brief</span><br></pre></td></tr></table></figure><h2 id="关于os基本信息"><a href="#关于os基本信息" class="headerlink" title="关于os基本信息"></a>关于os基本信息</h2><p>命令：assoc create delete get list set call</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic os list brief</span><br></pre></td></tr></table></figure><p><code>wmic os get /? </code>   #查看全部</p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657177138835-b78dd1f8-e587-4f0f-9003-67be182b62c4-20221107004217446.png" alt="img"></p><p>查看bios</p><p>wmic bios get biosversion,name</p><p>查看进程</p><p>process:</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">assoc</span> create delete get list <span class="built_in">set</span> <span class="keyword">call</span></span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process list brief</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process <span class="keyword">call</span> create calc</span><br></pre></td></tr></table></figure><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657177307849-d9b1459d-f006-4337-b559-1a6aa4629491.png" alt="img"></p><p>call这个也支持命令混淆，不过和cmd有一些区别</p><h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><p>service</p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657177505062-4f001527-5d6a-4c22-b71a-d7abfc8d2f70.png" alt="img"></p><p>wmic service where name&#x3D;” ***” call stopservice</p><p>计划任务</p><p>job</p><p>qfe</p><p>wmic qfe list brief</p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657177681285-dfd1fbc4-9692-4061-8b1b-2ed38e2b6068.png" alt="img"></p><p>删除一个补丁</p><p>wmic qfe where HotFixID&#x3D;”***” delete</p><p>product</p><p>wmic product get name,version</p><p>输出结果(上面每一个都可以输出)</p><p>wmic <strong>&#x2F;output:*<em>*</em></strong>  product ……..</p><p>网络</p><p>nicconfig<img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657177872456-eccc8a2f-fe37-4008-a5ae-a8c85948ae2a.png" alt="img"></p><p>fsdir</p><p>wmic fsdir where drive&#x3D;”C:” and filename&#x3D;’windows’” list</p><p>远程执行</p><p>wmic &#x2F;node:ip &#x2F;user: &#x2F;password: process call create calc</p><p>查看错误原因</p><p>net helpmsg </p><p>3389 –rdt模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic rdtoggle list</span><br></pre></td></tr></table></figure><p>开3389</p><p>修改注册表(需要管理员权限)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br></pre></td></tr></table></figure><p>关闭就是全1</p><p><img src="https://0000ff-1306704085.cos.ap-nanjing.myqcloud.com/1657178519933-4e242de9-58f4-4e13-816a-8b7d26e09a3a.png" alt="img"></p><p>2003以后</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /namespace:\\root\CIMV2\TerminalServices PATH Win32_TerminalServiceSetting WHERE(__CLASS !=&quot;&quot;) CALL SetAllowTSConnections 1</span><br></pre></td></tr></table></figure><p>2003</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic RDTOGGLE WHERE Name=&#x27;%WEIYIGEEK%&#x27; call SetAllowTSConnections 1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 内网 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
